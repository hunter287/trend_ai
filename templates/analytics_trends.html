<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ú–æ–¥–Ω—ã–µ —Ç—Ä–µ–Ω–¥—ã - –ê–Ω–∞–ª–∏—Ç–∏–∫–∞</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .navigation {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .nav-btn {
            padding: 12px 24px;
            background: rgba(255,255,255,0.2);
            color: white;
            text-decoration: none;
            border-radius: 25px;
            font-weight: 600;
            transition: all 0.3s;
            border: 2px solid transparent;
        }

        .nav-btn:hover {
            background: rgba(255,255,255,0.3);
            transform: translateY(-2px);
        }

        .nav-btn.active {
            background: rgba(255,255,255,0.9);
            color: #667eea;
            border-color: white;
        }

        .content {
            padding: 40px;
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
            gap: 30px;
            margin-bottom: 30px;
        }

        .chart-card {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .chart-card h3 {
            margin-bottom: 20px;
            color: #333;
            font-size: 1.3em;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .chart-container {
            position: relative;
            height: 350px;
        }

        .chart-container.large {
            height: 450px;
        }

        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 300px;
            color: #6c757d;
            font-size: 1.2em;
        }

        .loading:after {
            content: '...';
            animation: dots 1.5s steps(4, end) infinite;
        }

        @keyframes dots {
            0%, 20% { content: '.'; }
            40% { content: '..'; }
            60% { content: '...'; }
            80%, 100% { content: ''; }
        }

        .stats-overview {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 15px;
            text-align: center;
        }

        .stat-value {
            font-size: 2.5em;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .stat-label {
            font-size: 1em;
            opacity: 0.9;
        }

        .error-message {
            background: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
            border-left: 4px solid #dc3545;
        }

        .color-palette {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-top: 10px;
        }

        .color-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
        }

        .color-swatch {
            width: 60px;
            height: 60px;
            border-radius: 10px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
            border: 3px solid white;
        }

        .color-label {
            font-size: 0.9em;
            color: #6c757d;
            text-align: center;
        }

        .color-count {
            font-weight: bold;
            color: #333;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è —Ç–∞–±–æ–≤ */
        .tabs-container {
            margin-bottom: 20px;
        }

        .tabs {
            display: flex;
            gap: 10px;
            border-bottom: 2px solid #e9ecef;
            margin-bottom: 20px;
        }

        .tab-btn {
            padding: 10px 20px;
            background: transparent;
            border: none;
            cursor: pointer;
            color: #6c757d;
            font-size: 1em;
            font-weight: 600;
            transition: all 0.3s;
            border-bottom: 3px solid transparent;
            position: relative;
            top: 2px;
        }

        .tab-btn:hover {
            color: #667eea;
        }

        .tab-btn.active {
            color: #667eea;
            border-bottom-color: #667eea;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìä –ú–æ–¥–Ω—ã–µ —Ç—Ä–µ–Ω–¥—ã</h1>
            <p>–ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –º–æ–¥–Ω—ã—Ö —Ç—Ä–µ–Ω–¥–æ–≤ –Ω–∞ –æ—Å–Ω–æ–≤–µ –¥–∞–Ω–Ω—ã—Ö Instagram</p>

            <div class="navigation">
                <a href="/" class="nav-btn">üîç –ü–∞—Ä—Å–µ—Ä</a>
                <a href="/gallery" class="nav-btn">üì∑ –ì–∞–ª–µ—Ä–µ—è</a>
                <a href="/gallery_to_tag" class="nav-btn">üè∑Ô∏è –í—ã–±—Ä–∞–Ω–æ –¥–ª—è —Ç–µ–≥–≥–∏—Ä–æ–≤–∞–Ω–∏—è</a>
                <a href="/gallery_tagged" class="nav-btn">‚úÖ –û—Ç—Ç–µ–≥–∏—Ä–æ–≤–∞–Ω—ã</a>
                <a href="/gallery_hidden" class="nav-btn">üôà –°–∫—Ä—ã—Ç—ã–µ</a>
                <a href="/analytics/trends" class="nav-btn active">üìä –ê–Ω–∞–ª–∏—Ç–∏–∫–∞</a>
            </div>
        </div>

        <div class="content">
            <!-- –û–±–∑–æ—Ä–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
            <div class="stats-overview" id="statsOverview">
                <div class="stat-card">
                    <div class="stat-value" id="totalImages">-</div>
                    <div class="stat-label">–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–æ</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="totalCategories">-</div>
                    <div class="stat-label">–ö–∞—Ç–µ–≥–æ—Ä–∏–π –æ–±–Ω–∞—Ä—É–∂–µ–Ω–æ</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="totalColors">-</div>
                    <div class="stat-label">–£–Ω–∏–∫–∞–ª—å–Ω—ã—Ö —Ü–≤–µ—Ç–æ–≤</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="totalMaterials">-</div>
                    <div class="stat-label">–¢–∏–ø–æ–≤ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤</div>
                </div>
            </div>

            <!-- –î–∞—à–±–æ—Ä–¥—ã -->
            <div class="dashboard-grid">
                <!-- –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ -->
                <div class="chart-card">
                    <h3>üëó –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</h3>
                    <div class="chart-container">
                        <canvas id="categoriesChart"></canvas>
                    </div>
                </div>

                <!-- –¢–æ–ø-10 –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–π -->
                <div class="chart-card">
                    <h3>üî• –¢–æ–ø-10 –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–π</h3>
                    <div class="chart-container">
                        <canvas id="subcategoriesChart"></canvas>
                    </div>
                </div>

                <!-- –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ —Ü–≤–µ—Ç–∞ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º -->
                <div class="chart-card">
                    <h3>üé® –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ —Ü–≤–µ—Ç–∞ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º</h3>
                    <div class="tabs-container">
                        <div class="tabs">
                            <button class="tab-btn active" onclick="switchTab('colors', 'Clothing')">üëó –û–¥–µ–∂–¥–∞</button>
                            <button class="tab-btn" onclick="switchTab('colors', 'Footwear')">üëü –û–±—É–≤—å</button>
                            <button class="tab-btn" onclick="switchTab('colors', 'Accessories')">üëú –ê–∫—Å–µ—Å—Å—É–∞—Ä—ã</button>
                        </div>
                        <div id="colors-Clothing" class="tab-content active">
                            <div class="chart-container">
                                <canvas id="colorsChartClothing"></canvas>
                            </div>
                        </div>
                        <div id="colors-Footwear" class="tab-content">
                            <div class="chart-container">
                                <canvas id="colorsChartFootwear"></canvas>
                            </div>
                        </div>
                        <div id="colors-Accessories" class="tab-content">
                            <div class="chart-container">
                                <canvas id="colorsChartAccessories"></canvas>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º -->
                <div class="chart-card">
                    <h3>üßµ –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º</h3>
                    <div class="tabs-container">
                        <div class="tabs">
                            <button class="tab-btn active" onclick="switchTab('materials', 'Clothing')">üëó –û–¥–µ–∂–¥–∞</button>
                            <button class="tab-btn" onclick="switchTab('materials', 'Footwear')">üëü –û–±—É–≤—å</button>
                            <button class="tab-btn" onclick="switchTab('materials', 'Accessories')">üëú –ê–∫—Å–µ—Å—Å—É–∞—Ä—ã</button>
                        </div>
                        <div id="materials-Clothing" class="tab-content active">
                            <div class="chart-container">
                                <canvas id="materialsChartClothing"></canvas>
                            </div>
                        </div>
                        <div id="materials-Footwear" class="tab-content">
                            <div class="chart-container">
                                <canvas id="materialsChartFootwear"></canvas>
                            </div>
                        </div>
                        <div id="materials-Accessories" class="tab-content">
                            <div class="chart-container">
                                <canvas id="materialsChartAccessories"></canvas>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ —Å—Ç–∏–ª–∏ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º -->
                <div class="chart-card">
                    <h3>‚ú® –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ —Å—Ç–∏–ª–∏ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º</h3>
                    <div class="tabs-container">
                        <div class="tabs">
                            <button class="tab-btn active" onclick="switchTab('styles', 'Clothing')">üëó –û–¥–µ–∂–¥–∞</button>
                            <button class="tab-btn" onclick="switchTab('styles', 'Footwear')">üëü –û–±—É–≤—å</button>
                            <button class="tab-btn" onclick="switchTab('styles', 'Accessories')">üëú –ê–∫—Å–µ—Å—Å—É–∞—Ä—ã</button>
                        </div>
                        <div id="styles-Clothing" class="tab-content active">
                            <div class="chart-container">
                                <canvas id="stylesChartClothing"></canvas>
                            </div>
                        </div>
                        <div id="styles-Footwear" class="tab-content">
                            <div class="chart-container">
                                <canvas id="stylesChartFootwear"></canvas>
                            </div>
                        </div>
                        <div id="styles-Accessories" class="tab-content">
                            <div class="chart-container">
                                <canvas id="stylesChartAccessories"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- –¢—Ä–µ–Ω–¥—ã –ø–æ –≤—Ä–µ–º–µ–Ω–∏ (–ø–æ–ª–Ω–∞—è —à–∏—Ä–∏–Ω–∞) -->
            <div class="chart-card">
                <h3>üìà –¢—Ä–µ–Ω–¥—ã –ø–æ –≤—Ä–µ–º–µ–Ω–∏</h3>
                <div class="chart-container large">
                    <canvas id="timelineChart"></canvas>
                </div>
            </div>
        </div>
    </div>

    <script>
        // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Ü–≤–µ—Ç–æ–≤ –¥–ª—è –≥—Ä–∞—Ñ–∏–∫–æ–≤
        const chartColors = {
            primary: '#667eea',
            secondary: '#764ba2',
            success: '#28a745',
            danger: '#dc3545',
            warning: '#ffc107',
            info: '#17a2b8',
            palette: [
                '#667eea', '#764ba2', '#f093fb', '#4facfe',
                '#43e97b', '#fa709a', '#fee140', '#30cfd0',
                '#a8edea', '#fed6e3', '#c471ed', '#12c2e9'
            ]
        };

        // –ú–∞–ø–ø–∏–Ω–≥ —Ü–≤–µ—Ç–æ–≤ –Ω–∞ CSS —Ü–≤–µ—Ç–∞
        const colorMapping = {
            'Black': '#000000',
            'White': '#FFFFFF',
            'Red': '#FF0000',
            'Blue': '#0000FF',
            'Green': '#00FF00',
            'Yellow': '#FFFF00',
            'Pink': '#FFC0CB',
            'Purple': '#800080',
            'Orange': '#FFA500',
            'Brown': '#8B4513',
            'Gray': '#808080',
            'Grey': '#808080',
            'Beige': '#F5F5DC',
            'Navy': '#000080',
            'Turquoise': '#40E0D0',
            'Gold': '#FFD700',
            'Silver': '#C0C0C0'
        };

        // –ì–ª–æ–±–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –¥–∞–Ω–Ω—ã—Ö
        let analyticsData = {
            colorsByCategory: null,
            materialsByCategory: null,
            stylesByCategory: null
        };

        // –§—É–Ω–∫—Ü–∏—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Ç–∞–±–æ–≤
        function switchTab(section, category) {
            // –£–±–∏—Ä–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å —Å–æ –≤—Å–µ—Ö –∫–Ω–æ–ø–æ–∫ –≤ —ç—Ç–æ–π —Å–µ–∫—Ü–∏–∏
            const parentCard = document.querySelector(`#${section}-${category}`).closest('.chart-card');
            const tabs = parentCard.querySelectorAll('.tab-btn');
            tabs.forEach(tab => tab.classList.remove('active'));

            // –î–æ–±–∞–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å –Ω–∞ –≤—ã–±—Ä–∞–Ω–Ω—É—é –∫–Ω–æ–ø–∫—É
            event.target.classList.add('active');

            // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ —Ç–∞–±—ã –≤ —ç—Ç–æ–π —Å–µ–∫—Ü–∏–∏
            const allTabs = parentCard.querySelectorAll('.tab-content');
            allTabs.forEach(tab => tab.classList.remove('active'));

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–π —Ç–∞–±
            document.getElementById(`${section}-${category}`).classList.add('active');
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö
        async function loadAnalytics() {
            try {
                // –ó–∞–≥—Ä—É–∂–∞–µ–º –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ
                const [categories, subcategories, colorsByCategory, materialsByCategory, stylesByCategory, timeline] = await Promise.all([
                    fetch('/api/analytics/categories-stats').then(r => r.json()),
                    fetch('/api/analytics/subcategories-stats').then(r => r.json()),
                    fetch('/api/analytics/colors-by-category').then(r => r.json()),
                    fetch('/api/analytics/materials-by-category').then(r => r.json()),
                    fetch('/api/analytics/styles-by-category').then(r => r.json()),
                    fetch('/api/analytics/trends-timeline').then(r => r.json())
                ]);

                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ
                analyticsData.colorsByCategory = colorsByCategory;
                analyticsData.materialsByCategory = materialsByCategory;
                analyticsData.stylesByCategory = stylesByCategory;

                // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
                if (categories.success) {
                    const totalImages = categories.categories.reduce((sum, c) => sum + c.count, 0);
                    document.getElementById('totalImages').textContent = totalImages.toLocaleString();
                    document.getElementById('totalCategories').textContent = categories.categories.length;
                }

                // –ü–æ–¥—Å—á–∏—Ç—ã–≤–∞–µ–º –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö —Ü–≤–µ—Ç–æ–≤ –∏ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤
                if (colorsByCategory.success) {
                    const allColors = new Set();
                    Object.values(colorsByCategory.data).forEach(colors => {
                        colors.forEach(c => allColors.add(c.name));
                    });
                    document.getElementById('totalColors').textContent = allColors.size;
                }

                if (materialsByCategory.success) {
                    const allMaterials = new Set();
                    Object.values(materialsByCategory.data).forEach(materials => {
                        materials.forEach(m => allMaterials.add(m.name));
                    });
                    document.getElementById('totalMaterials').textContent = allMaterials.size;
                }

                // –†–∏—Å—É–µ–º –≥—Ä–∞—Ñ–∏–∫–∏
                if (categories.success) drawCategoriesChart(categories.categories);
                if (subcategories.success) drawSubcategoriesChart(subcategories.subcategories);

                // –†–∏—Å—É–µ–º –≥—Ä–∞—Ñ–∏–∫–∏ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
                if (colorsByCategory.success) {
                    drawColorsByCategoryChart('Clothing', colorsByCategory.data.Clothing);
                    drawColorsByCategoryChart('Footwear', colorsByCategory.data.Footwear);
                    drawColorsByCategoryChart('Accessories', colorsByCategory.data.Accessories);
                }

                if (materialsByCategory.success) {
                    drawMaterialsByCategoryChart('Clothing', materialsByCategory.data.Clothing);
                    drawMaterialsByCategoryChart('Footwear', materialsByCategory.data.Footwear);
                    drawMaterialsByCategoryChart('Accessories', materialsByCategory.data.Accessories);
                }

                if (stylesByCategory.success) {
                    drawStylesByCategoryChart('Clothing', stylesByCategory.data.Clothing);
                    drawStylesByCategoryChart('Footwear', stylesByCategory.data.Footwear);
                    drawStylesByCategoryChart('Accessories', stylesByCategory.data.Accessories);
                }

                if (timeline.success) drawTimelineChart(timeline.timeline);

            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏:', error);
                document.querySelector('.content').insertAdjacentHTML('afterbegin',
                    '<div class="error-message">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö: ' + error.message + '</div>');
            }
        }

        // –ì—Ä–∞—Ñ–∏–∫ –∫–∞—Ç–µ–≥–æ—Ä–∏–π (–∫—Ä—É–≥–æ–≤–∞—è –¥–∏–∞–≥—Ä–∞–º–º–∞)
        function drawCategoriesChart(data) {
            const ctx = document.getElementById('categoriesChart').getContext('2d');
            new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: data.map(d => d.name),
                    datasets: [{
                        data: data.map(d => d.count),
                        backgroundColor: chartColors.palette,
                        borderWidth: 2,
                        borderColor: '#fff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                padding: 15,
                                font: {
                                    size: 12
                                }
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                    const percentage = ((context.parsed / total) * 100).toFixed(1);
                                    return context.label + ': ' + context.parsed.toLocaleString() + ' (' + percentage + '%)';
                                }
                            }
                        }
                    }
                }
            });
        }

        // –ì—Ä–∞—Ñ–∏–∫ –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–π (–≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–∞—è –≥–∏—Å—Ç–æ–≥—Ä–∞–º–º–∞)
        function drawSubcategoriesChart(data) {
            const ctx = document.getElementById('subcategoriesChart').getContext('2d');
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: data.map(d => d.name),
                    datasets: [{
                        label: '–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ',
                        data: data.map(d => d.count),
                        backgroundColor: chartColors.palette[0],
                        borderRadius: 8
                    }]
                },
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                title: function(context) {
                                    return data[context[0].dataIndex].name + ' (' + data[context[0].dataIndex].category + ')';
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            beginAtZero: true,
                            grid: {
                                display: true
                            }
                        },
                        y: {
                            grid: {
                                display: false
                            }
                        }
                    }
                }
            });
        }

        // –ì—Ä–∞—Ñ–∏–∫ —Ü–≤–µ—Ç–æ–≤ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ (–≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–∞—è –≥–∏—Å—Ç–æ–≥—Ä–∞–º–º–∞ —Å —Ü–≤–µ—Ç–∞–º–∏)
        function drawColorsByCategoryChart(category, data) {
            const ctx = document.getElementById(`colorsChart${category}`).getContext('2d');

            // –°–æ–∑–¥–∞–µ–º —Ü–≤–µ—Ç–∞ –¥–ª—è –±–∞—Ä–æ–≤ –Ω–∞ –æ—Å–Ω–æ–≤–µ –Ω–∞–∑–≤–∞–Ω–∏–π
            const backgroundColors = data.map(d => {
                const colorName = d.name;
                return colorMapping[colorName] || chartColors.palette[0];
            });

            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: data.map(d => d.name),
                    datasets: [{
                        label: '–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ',
                        data: data.map(d => d.count),
                        backgroundColor: backgroundColors,
                        borderColor: '#fff',
                        borderWidth: 1,
                        borderRadius: 8
                    }]
                },
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        x: {
                            beginAtZero: true,
                            grid: {
                                display: true
                            }
                        },
                        y: {
                            grid: {
                                display: false
                            }
                        }
                    }
                }
            });
        }

        // –ì—Ä–∞—Ñ–∏–∫ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ (–∫—Ä—É–≥–æ–≤–∞—è –¥–∏–∞–≥—Ä–∞–º–º–∞)
        function drawMaterialsByCategoryChart(category, data) {
            const ctx = document.getElementById(`materialsChart${category}`).getContext('2d');
            new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: data.map(d => d.name),
                    datasets: [{
                        data: data.map(d => d.count),
                        backgroundColor: chartColors.palette,
                        borderWidth: 2,
                        borderColor: '#fff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                padding: 15,
                                font: {
                                    size: 12
                                }
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                    const percentage = ((context.parsed / total) * 100).toFixed(1);
                                    return context.label + ': ' + context.parsed.toLocaleString() + ' (' + percentage + '%)';
                                }
                            }
                        }
                    }
                }
            });
        }

        // –ì—Ä–∞—Ñ–∏–∫ —Å—Ç–∏–ª–µ–π –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ (–∫—Ä—É–≥–æ–≤–∞—è –¥–∏–∞–≥—Ä–∞–º–º–∞)
        function drawStylesByCategoryChart(category, data) {
            const ctx = document.getElementById(`stylesChart${category}`).getContext('2d');
            new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: data.map(d => d.name),
                    datasets: [{
                        data: data.map(d => d.count),
                        backgroundColor: chartColors.palette,
                        borderWidth: 2,
                        borderColor: '#fff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                padding: 15,
                                font: {
                                    size: 12
                                }
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                    const percentage = ((context.parsed / total) * 100).toFixed(1);
                                    return context.label + ': ' + context.parsed.toLocaleString() + ' (' + percentage + '%)';
                                }
                            }
                        }
                    }
                }
            });
        }

        // –ì—Ä–∞—Ñ–∏–∫ —Ç—Ä–µ–Ω–¥–æ–≤ –ø–æ –≤—Ä–µ–º–µ–Ω–∏ (–ª–∏–Ω–µ–π–Ω—ã–π –≥—Ä–∞—Ñ–∏–∫)
        function drawTimelineChart(timeline) {
            const ctx = document.getElementById('timelineChart').getContext('2d');

            const datasets = Object.keys(timeline.series).map((category, index) => ({
                label: category,
                data: timeline.series[category],
                borderColor: chartColors.palette[index % chartColors.palette.length],
                backgroundColor: chartColors.palette[index % chartColors.palette.length] + '20',
                borderWidth: 2,
                tension: 0.4,
                fill: true
            }));

            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: timeline.months,
                    datasets: datasets
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: {
                        mode: 'index',
                        intersect: false,
                    },
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                padding: 15,
                                font: {
                                    size: 12
                                }
                            }
                        },
                        tooltip: {
                            callbacks: {
                                title: function(context) {
                                    return '–ú–µ—Å—è—Ü: ' + context[0].label;
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            grid: {
                                display: false
                            }
                        },
                        y: {
                            beginAtZero: true,
                            grid: {
                                display: true
                            }
                        }
                    }
                }
            });
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', function() {
            loadAnalytics();
        });
    </script>
</body>
</html>
